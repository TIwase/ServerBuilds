#### 2020/05/03 追記

# EC2(Amazon Linux 2)上でALB(Application Load Balancer)とHTTPSを利用したwordpress運用方法

※EC2(Amazon Linux 2)にApacheとwordpressがインストールされていることが前提

→[EC2 + wordpressのインストールはここから](wordpress_installation.md)

## 01. 独自ドメイン取得

AWSのコンソールにログインし、Route53を選択。

任意のドメインを申請する(※詳しい内容は忘れたため省略)

## 02. SSL証明書の発行

ここではAWSサービスのACM(Amazon Certificate Manager)を利用する。

AWSのコンソールにログインし、[Certificate Manager] > [証明書のリクエスト]を選択。

↓

Route53で取得した独自ドメイン(サブドメイン含む)を追加して[次へ]を選択。

↓

検証方法は、[DNSの検証]にチェックを入れて[次へ]を選択。

↓

タグ名は任意で追加して[確認]を選択。(タグを追加しなくても問題ない)

↓

[検証とリクエスト]を選択。

↓

リクエストしたドメイン名の左にある▸をクリックし、表示されたドメインの▸をさらにクリックする。

↓

[Route53でのレコードの作成]ボタンが表示されるのでクリック。
(※Route53にあるDNS設定のCNAMEレコードに、証明書のリクエストした情報が自動で追加される。)

一定時間経過後、状況が検証保留中から発行済みに変わっていることが確認できればok (この時、更新資格は使用不可のままだった気がする)

## 03. ALB(Application Load Balancer)の作成

↓

サービスからEC2を選択し、左のメニューからロードバランサーを選択。

↓

[ロードバランサーの作成]をクリックして、ALBの[作成]を選択。

任意の名前を記入し、[リスナーの追加]をクリックしてHTTPSを追加する。

↓

アベイラビリティゾーンに最低2つのサブネットを指定して[次の手順]を選択。

↓

セキュリティグループ設定では、HTTPS化するwordpressインスタンスが所属しているセキュリティグループ名を選択して[次の手順]をクリック。

↓

ルーティング設定では、新しいターゲットグループを選択して任意の名前を入力して[次の手順]をクリック。

↓

ターゲットの登録では、wordpressインスタンスを選択してポート80で[登録済みに追加]をクリック。

次に、ポート443で同様に[登録済みに追加]をクリック。

↓

最後にすべての設定内容を確認して相違がなければ[作成]をクリック。

## 04. Aレコードの追加

[Route53] > [ホストゾーン] > [レコードセットの作成]を選択する。

↓

名前にサブドメインを入力し、タイプはA-IPv4アドレス(Aレコード)、エイリアスの「はい」にチェックを入れる。

↓

エイリアス先に先ほど作成したロードバランサーの値を選択して[作成]をクリック。


ブラウザを起動してHTTPSアクセスしてURLの一番左に鍵マークが表示されていればok


## 付録(※やらなくてもいいです)

ブラウザを起動してもページが表示されない(あるいはcssが崩れている)場合、下記を実施。

